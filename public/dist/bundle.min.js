function saveLocal(n,e){localStorage[n]=e}function getLocal(n){return localStorage[n]}function deleteLocal(n){localStorage.removeItem(n)}var app=angular.module("Application",["ui.router","ngResource","ngMessages","ngAnimate","ngMaterial","ngLetterAvatar"]);angular.module("Application").run(["$rootScope","$state","$mdToast",function(n,e,o){n.go=function(n,o){e.go(n,o)},n.showSimpleToast=function(n){o.show(o.simple().textContent(n).position("top right").hideDelay(3e3))}}]),angular.module("Application").config(["$stateProvider","$urlRouterProvider","$httpProvider","$mdThemingProvider",function(n,e,o,t){n.state("login",{url:"/login",onEnter:["$rootScope",function(n){getLocal("user")&&n.go("application")}],templateUrl:"/views/_login/main.html",controller:"LoginCtrl"}).state("application",{url:"/",onEnter:["$rootScope",function(n){getLocal("user")||n.go("login")}],templateUrl:"/views/_application/main.html",controller:"ApplicationCtrl"}),e.otherwise("/login"),o.interceptors.push("AuthInterceptor"),t.theme("smartTheme").primaryPalette("orange").accentPalette("yellow")}]),angular.module("Application").controller("ApplicationCtrl",["$rootScope","$scope","OAuthService","RequestService",function(n,e,o,t){e.user={},e.array_colors=Array.apply(null,Array(27)).map(function(){return"#FF9800"}),e.openMenu=function(n,e){originatorEv=e,n(e)},this.WhoIAm=function(){o.whoiam()._(t.OneData("email",function(n){e.user.email=n}),t.Error())},this.WhoIAm(),e.logout=function(){o.logout()._(function(e){console.log(e),deleteLocal("user"),n.go("login")},t.Error())}}]),angular.module("Application").controller("LoginCtrl",["$rootScope","$scope","OAuthService","RequestService",function(n,e,o,t){e.user={email:"",password:""},e.login=function(){var a=e.user;""!==a.email&&a.password&&o.login()._(a,t.OneData("token",function(e){saveLocal("user",e),n.go("application")}),t.Error())}}]),function(n){try{n=angular.module("Application")}catch(e){n=angular.module("Application",[])}n.run(["$templateCache",function(n){n.put("/views/_application/main.html",'<div layout="row" flex>\n    <md-sidenav layout="column" flex="20" class="md-sidenav-left md-whiteframe-z2"  id="sidebar" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-sm\')"  md-theme="smartTheme">\n        <header class="md-whiteframe-2dp">\n            <md-toolbar layout="row">\n                <h3 class="md-toolbar-tools" flex layout="row">\n                    <i class="icon house_with_garden_36" flex="20"></i>\n                    <span flex>Dashboard</span>\n                </h3>\n                <md-menu class="menu-sidebar">\n                    <md-button aria-label="Open phone interactions menu" class="md-icon-button" ng-click="openMenu($mdOpenMenu, $event)">\n                        <md-icon md-menu-origin md-font-icon="fa-ellipsis-v" class="fa"></md-icon>\n                    </md-button>\n                    <md-menu-content width="4">\n                        <md-menu-item>\n                            <span md-menu-align-target>Hello World!!</span>\n                        </md-menu-item>\n\n                    </md-menu-content>\n                </md-menu>\n            </md-toolbar>\n\n        </header>\n\n        <md-content>\n            <md-subheader class="md-primary" layout="row" ng-init="showOptions=false">\n                <span flex="10" class="avatar"><ng-letter-avatar ng-if="user.email" data="{{user.email}}" height="30px" width="30px" shape="round" alphabetcolors="array_colors"></ng-letter-avatar></span>\n                <span flex>{{user.email| nofirst}}\n                </span>\n\n                <md-icon md-font-icon="fa-chevron-down" class="fa md-primary" ng-click="showOptions=!showOptions"></md-icon>\n\n\n\n            </md-subheader>\n\n            <div class="popover-user-options md-open-menu-container md-whiteframe-z2 md-clickable" ng-class="{\'md-active\':showOptions}">\n                <div class="dropdown-caret">\n                    <span class="caret-outer"></span>\n                    <span class="caret-inner"></span>\n                </div>\n                <md-content>\n\n                    <div layout="column" layout-align="space-between none">\n                        <div  flex layout="row"  layout-align="space-between center" class="item-popover">\n                            <i class="fa fa-cog" flex="20"></i>\n                            <a flex>Settings</a>\n\n                        </div>\n                        \n                        <div  flex layout="row"  layout-align="space-between center" class="item-popover">\n                            <i class="fa fa-power-off" flex="20"></i>\n                            <a ng-click="logout()" flex>Logout</a>\n\n                        </div>\n\n                    </div>\n\n                </md-content>\n            </div>\n        </md-content>\n\n    </md-sidenav>\n\n\n    <div layout="column" flex id="content">\n        <md-content layout="column" flex class="md-padding" ui-view="content">\n\n        </md-content>\n\n    </div>\n</div>\n\n\n')}])}(),function(n){try{n=angular.module("Application")}catch(e){n=angular.module("Application",[])}n.run(["$templateCache",function(n){n.put("/views/_login/main.html",'\n<div  layout="row" layout-align="center center" layout-fill id="login-body" md-theme="smartTheme">\n\n\n    <div layout="column" flex-gt-md="35" flex-xs="50" flex-gt-xs="50" layout-padding>\n\n        <div layout="row" layout-align="center center">\n            <h2><i class="icon house_with_garden_72"></i><br>Smart Town Administration</h2>\n        </div>\n\n        <md-card layout="row" >\n            <form name="loginForm" flex layout="column" layout-align="center stretch" layout-padding layout-margin>\n                <h3 flex>Log in to your account</h3>\n                <md-input-container  class="md-block" flex>\n                    <label>Email</label>\n\n                    <input type="email" required name="email" ng-model="user.email" ng-pattern="/^.+@.+\\..+$/" >\n                    <div ng-messages="loginForm.email.$error" multiple md-auto-hide="false" ng-if=\'loginForm.email.$dirty\'>\n                        <div ng-message="required">This is required.</div>\n                        <div ng-message="pattern">\n                            Your email must look like an e-mail address.\n                        </div>\n                    </div>\n                </md-input-container>\n                <md-input-container   class="md-block" flex>\n                    <label>Password</label>\n\n                    <input ng-model="user.password" type="password" name="password" required>\n                    <div ng-messages="loginForm.password.$error" md-auto-hide="false" ng-if="loginForm.password.$dirty">\n                        <div ng-message="required">This is required.</div>\n                    </div>\n                </md-input-container>\n                <md-input-container layout-align="center center" flex>\n                    <div layout="row" layout-sm="column" layout-margin>\n                        <md-button class="md-raised" type="submit" ng-click="login()" flex flex-sm="100" ng>Login</md-button>\n\n                    </div>\n                </md-input-container>\n\n            </form>\n\n        </md-card>\n\n\n        <div layout="row" layout-align="center center">\n            <h5><i class="fa fa-copyright"></i> Smart Town 2016</h5>\n        </div>\n\n\n    </div>\n\n</div>\n\n\n')}])}(),angular.module("Application").filter("nofirst",function(){return function(n){return n?n.slice(1):""}}),angular.module("Application").factory("ApiService",["$resource","$location",function(n,e){return{env:-1==e.absUrl().indexOf("localhost")?"prod":"dev",prod:{protocol:"https",host:"smart-town-db.herokuapp.com",port:"",root:"api"},dev:{protocol:"http",host:"localhost",port:"5060",root:"api"},getApiPath:function(n){var e=this[this.env];return e.protocol+"://"+e.host+(""!==e.port?":"+e.port:"")+"/"+e.root+"/"+n},rest:function(e,o,t){var a=n(this.getApiPath(e),t||{},o||{});return a}}}]),angular.module("Application").factory("AuthInterceptor",["$q","$location",function(n,e){return{request:function(n){n.headers=n.headers||{};var e=getLocal("user");return!n.headers.Authorization&&e&&(n.headers.Authorization=e),n},requestError:function(e){return n.reject(e)},response:function(e){return"ERROR"===e.data.status?n.reject(e):e||n.when(e)},responseError:function(o){return 403===o.status?(console.error("Error de acceso"),localStorage.user="",void e.path("/")):n.reject(o)}}}]),angular.module("Application").factory("OAuthService",["ApiService",function(n){return{base:"oauth",login:function(){return n.rest(this.base+"/login",{_:{method:"POST",params:{}}})},logout:function(){return n.rest(this.base+"/logout",{_:{method:"GET",params:{}}})},whoiam:function(){return n.rest(this.base+"/whoiam",{_:{method:"GET",params:{}}})}}}]),angular.module("Application").factory("RequestService",["$rootScope",function(n){return{Error:function(){return function(e){var o=e.data;n.showSimpleToast(o.error)}},OneData:function(e,o){return function(t){if(!t.data)return n.showSimpleToast("No data");var a=t.data[e];return a?void o(a):n.showSimpleToast("No Values")}}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9qYXZhc2NyaXB0cy91dGlscy5qcyIsImFwcGxpY2F0aW9uLmpzIiwiY29uZmlnL2Jvb3QuanMiLCJjb25maWcvZW52aXJvbm1lbnQuanMiLCJjb250cm9sbGVycy9hcHBsaWNhdGlvbl9jb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvbG9naW5fY29udHJvbGxlci5qcyIsImFzc2V0cy90ZW1wbGF0ZXMvdGVtcGxhdGUtY2FjaGUuanMiLCJjb21wb25lbnRzL2ZpbHRlcnMvZm9ybWF0X2ZpbHRlcnMuanMiLCJjb21wb25lbnRzL3NlcnZpY2VzL2FwaV9zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9zZXJ2aWNlcy9pbnRlcmNlcHRvcl9zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9zZXJ2aWNlcy9vYXV0aF9zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9zZXJ2aWNlcy9yZXF1ZXN0X3NlcnZpY2UuanMiXSwibmFtZXMiOlsic2F2ZUxvY2FsIiwia2V5IiwiZGF0YSIsImxvY2FsU3RvcmFnZSIsImdldExvY2FsIiwiZGVsZXRlTG9jYWwiLCJyZW1vdmVJdGVtIiwiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsInJ1biIsIiRyb290U2NvcGUiLCIkc3RhdGUiLCIkbWRUb2FzdCIsImdvIiwic3RhdGUiLCJwYXJhbXMiLCJzaG93U2ltcGxlVG9hc3QiLCJtZXNzYWdlIiwic2hvdyIsInNpbXBsZSIsInRleHRDb250ZW50IiwicG9zaXRpb24iLCJoaWRlRGVsYXkiLCJjb25maWciLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCJ1cmwiLCJvbkVudGVyIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwib3RoZXJ3aXNlIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiJHNjb3BlIiwiT0F1dGhTZXJ2aWNlIiwiUmVxdWVzdFNlcnZpY2UiLCJ1c2VyIiwiYXJyYXlfY29sb3JzIiwiQXJyYXkiLCJhcHBseSIsIm1hcCIsIm9wZW5NZW51IiwiJG1kT3Blbk1lbnUiLCJldiIsIm9yaWdpbmF0b3JFdiIsInRoaXMiLCJXaG9JQW0iLCJ3aG9pYW0iLCJfIiwiT25lRGF0YSIsImVtYWlsIiwiRXJyb3IiLCJsb2dvdXQiLCJjb25zb2xlIiwibG9nIiwicGFzc3dvcmQiLCJsb2dpbiIsImUiLCIkdGVtcGxhdGVDYWNoZSIsInB1dCIsImZpbHRlciIsImlucHV0Iiwic2xpY2UiLCJmYWN0b3J5IiwiJHJlc291cmNlIiwiJGxvY2F0aW9uIiwiZW52IiwiYWJzVXJsIiwiaW5kZXhPZiIsInByb2QiLCJwcm90b2NvbCIsImhvc3QiLCJwb3J0Iiwicm9vdCIsImRldiIsImdldEFwaVBhdGgiLCJwYXRoIiwiYXBpIiwicmVzdCIsIm1ldGhvZHMiLCJkZWZhdWx0UGFyYW1zIiwicmVzb3VyY2UiLCIkcSIsInJlcXVlc3QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsInJlcXVlc3RFcnJvciIsInJlamVjdGlvbiIsInJlamVjdCIsInJlc3BvbnNlIiwic3RhdHVzIiwid2hlbiIsInJlc3BvbnNlRXJyb3IiLCJlcnJvciIsIkFwaVNlcnZpY2UiLCJiYXNlIiwibWV0aG9kIiwicmVzIiwiY2IiLCJ2YWx1ZSJdLCJtYXBwaW5ncyI6IkFBQUEsUUFBQUEsV0FBQUMsRUFBQUMsR0FDQUMsYUFBQUYsR0FBQUMsRUFHQSxRQUFBRSxVQUFBSCxHQUNBLE1BQUFFLGNBQUFGLEdBR0EsUUFBQUksYUFBQUosR0FDQUUsYUFBQUcsV0FBQUwsR0NUQSxHQUFBTSxLQUFBQyxRQUFBQyxPQUFBLGVBQUEsWUFBQSxhQUFBLGFBQUEsWUFBQSxhQUFBLGtCQ0FBRCxTQUFBQyxPQUFBLGVBQ0FDLEtBQUEsYUFBQSxTQUFBLFdBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FFQUYsRUFBQUcsR0FBQSxTQUFBQyxFQUFBQyxHQUNBSixFQUFBRSxHQUFB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QUFnRCxPQUFBLE1BQUF0RixrQkNqQkFSLFFBQUFDLE9BQUEsZUFDQTRELFFBQUEsa0JBQUEsYUFBQSxTQUFBMUQsR0FHQSxPQUNBOEMsTUFBQSxXQUNBLE1BQUEsVUFBQThDLEdBQ0EsR0FBQXJHLEdBQUFxRyxFQUFBckcsSUFDQVMsR0FBQU0sZ0JBQUFmLEVBQUFpRyxTQUlBNUMsUUFBQSxTQUFBdEQsRUFBQXVHLEdBQ0EsTUFBQSxVQUFBRCxHQUNBLElBQUFBLEVBQUFyRyxLQUNBLE1BQUFTLEdBQUFNLGdCQUFBLFVBRUEsSUFBQXdGLEdBQUFGLEVBQUFyRyxLQUFBRCxFQUNBLE9BQUF3RyxPQUdBRCxHQUFBQyxHQUhBOUYsRUFBQU0sZ0JBQUEiLCJmaWxlIjoiYnVuZGxlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHNhdmVMb2NhbChrZXksIGRhdGEpIHtcclxuICAgIGxvY2FsU3RvcmFnZVtrZXldID0gZGF0YTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0TG9jYWwoa2V5KSB7XHJcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlW2tleV07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlbGV0ZUxvY2FsKGtleSkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxufSIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnQXBwbGljYXRpb24nLCBbJ3VpLnJvdXRlcicsIFwibmdSZXNvdXJjZVwiLCduZ01lc3NhZ2VzJywnbmdBbmltYXRlJywgJ25nTWF0ZXJpYWwnLCAnbmdMZXR0ZXJBdmF0YXInXSk7XHJcblxyXG4iLCJhbmd1bGFyLm1vZHVsZSgnQXBwbGljYXRpb24nKVxyXG4gICAgLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCAkc3RhdGUsICRtZFRvYXN0KXtcclxuICAgIFxyXG4gICAgJHJvb3RTY29wZS5nbyA9IGZ1bmN0aW9uIChzdGF0ZSwgcGFyYW1zKSB7XHJcbiAgICAgICAgJHN0YXRlLmdvKHN0YXRlLCBwYXJhbXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkcm9vdFNjb3BlLnNob3dTaW1wbGVUb2FzdCA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcclxuXHJcbiAgICAgICAgJG1kVG9hc3Quc2hvdyhcclxuICAgICAgICAgICAgJG1kVG9hc3Quc2ltcGxlKClcclxuICAgICAgICAgICAgLnRleHRDb250ZW50KG1lc3NhZ2UpXHJcbiAgICAgICAgICAgIC5wb3NpdGlvbihcInRvcCByaWdodFwiKVxyXG4gICAgICAgICAgICAuaGlkZURlbGF5KDMwMDApXHJcbiAgICAgICAgKTtcclxuICAgIH07XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnQXBwbGljYXRpb24nKVxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyLCAkbWRUaGVtaW5nUHJvdmlkZXIpe1xyXG5cclxuXHJcbiAgICAvKipSb3V0ZXMqKi9cclxuICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgLnN0YXRlKFwibG9naW5cIiwge1xyXG4gICAgICAgIHVybDpcIi9sb2dpblwiLFxyXG4gICAgICAgIG9uRW50ZXI6ZnVuY3Rpb24oJHJvb3RTY29wZSl7XHJcbiAgICAgICAgICAgIGlmKGdldExvY2FsKFwidXNlclwiKSl7XHJcbiAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5nbyhcImFwcGxpY2F0aW9uXCIpO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6Jy92aWV3cy9fbG9naW4vbWFpbi5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOlwiTG9naW5DdHJsXCJcclxuXHJcbiAgICB9KVxyXG4gICAgICAgIC5zdGF0ZShcImFwcGxpY2F0aW9uXCIsIHtcclxuICAgICAgICB1cmw6XCIvXCIsXHJcbiAgICAgICAgb25FbnRlcjpmdW5jdGlvbigkcm9vdFNjb3BlKXtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCFnZXRMb2NhbChcInVzZXJcIikpe1xyXG4gICAgICAgICAgICAgICAgICRyb290U2NvcGUuZ28oXCJsb2dpblwiKTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOicvdmlld3MvX2FwcGxpY2F0aW9uL21haW4uaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjpcIkFwcGxpY2F0aW9uQ3RybFwiXHJcblxyXG4gICAgfSk7XHJcblxyXG5cclxuXHJcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL2xvZ2luXCIpO1xyXG5cclxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG5cclxuXHJcbiAgICAvKipUaGVtZXMqKi9cclxuICAgICRtZFRoZW1pbmdQcm92aWRlci50aGVtZSgnc21hcnRUaGVtZScpXHJcbiAgICAgICAgLnByaW1hcnlQYWxldHRlKCdvcmFuZ2UnKVxyXG4gICAgICAgIC5hY2NlbnRQYWxldHRlKCd5ZWxsb3cnKTtcclxuICAgIFxyXG4gICBcclxuXHJcblxyXG4gIFxyXG5cclxufSk7XHJcblxyXG4iLCJhbmd1bGFyLm1vZHVsZSgnQXBwbGljYXRpb24nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgT0F1dGhTZXJ2aWNlLCBSZXF1ZXN0U2VydmljZSl7XHJcblxyXG4gICAgJHNjb3BlLnVzZXI9e307XHJcblxyXG4gICAgJHNjb3BlLmFycmF5X2NvbG9ycz1BcnJheS5hcHBseShudWxsLCBBcnJheSgyNykpLm1hcChmdW5jdGlvbigpe3JldHVybiBcIiNGRjk4MDBcIn0pO1xyXG5cclxuICAgICRzY29wZS5vcGVuTWVudSA9IGZ1bmN0aW9uKCRtZE9wZW5NZW51LCBldikge1xyXG4gICAgICAgIG9yaWdpbmF0b3JFdiA9IGV2O1xyXG4gICAgICAgICRtZE9wZW5NZW51KGV2KTtcclxuICAgIH07XHJcblxyXG5cclxuICAgIHRoaXMuV2hvSUFtPWZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgIE9BdXRoU2VydmljZS4gd2hvaWFtKCkuXyhSZXF1ZXN0U2VydmljZS5PbmVEYXRhKFwiZW1haWxcIiwgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VyLmVtYWlsPWRhdGE7XHJcblxyXG4gICAgICAgIH0pLFJlcXVlc3RTZXJ2aWNlLkVycm9yKCkpOyAgXHJcblxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLldob0lBbSgpO1xyXG5cclxuICAgICRzY29wZS5sb2dvdXQ9ZnVuY3Rpb24oKXtcclxuICAgICAgICBPQXV0aFNlcnZpY2UubG9nb3V0KCkuXyhmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgIGRlbGV0ZUxvY2FsKFwidXNlclwiKTtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuZ28oXCJsb2dpblwiKTtcclxuXHJcbiAgICAgICAgfSxSZXF1ZXN0U2VydmljZS5FcnJvcigpKTsgIFxyXG4gICAgfTtcclxuXHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnQXBwbGljYXRpb24nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgT0F1dGhTZXJ2aWNlLCBSZXF1ZXN0U2VydmljZSl7XHJcblxyXG4gICAgJHNjb3BlLnVzZXI9e1xyXG4gICAgICAgIGVtYWlsOlwiXCIsXHJcbiAgICAgICAgcGFzc3dvcmQ6XCJcIlxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAkc2NvcGUubG9naW49ZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgdXNlcj0kc2NvcGUudXNlcjtcclxuICAgICAgICBpZih1c2VyLmVtYWlsIT09XCJcIiAmJiB1c2VyLnBhc3N3b3JkKXtcclxuXHJcbiAgICAgICAgICAgIE9BdXRoU2VydmljZS5sb2dpbigpLl8odXNlciwgUmVxdWVzdFNlcnZpY2UuT25lRGF0YShcInRva2VuXCIsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICAgICAgc2F2ZUxvY2FsKFwidXNlclwiLCBkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmdvKFwiYXBwbGljYXRpb25cIik7XHJcblxyXG4gICAgICAgICAgICB9KSxSZXF1ZXN0U2VydmljZS5FcnJvcigpKTsgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbn0pOyIsIihmdW5jdGlvbihtb2R1bGUpIHtcbnRyeSB7XG4gIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdBcHBsaWNhdGlvbicpO1xufSBjYXRjaCAoZSkge1xuICBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnQXBwbGljYXRpb24nLCBbXSk7XG59XG5tb2R1bGUucnVuKFsnJHRlbXBsYXRlQ2FjaGUnLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkge1xuICAkdGVtcGxhdGVDYWNoZS5wdXQoJy92aWV3cy9fYXBwbGljYXRpb24vbWFpbi5odG1sJyxcbiAgICAnPGRpdiBsYXlvdXQ9XCJyb3dcIiBmbGV4PlxcbicgK1xuICAgICcgICAgPG1kLXNpZGVuYXYgbGF5b3V0PVwiY29sdW1uXCIgZmxleD1cIjIwXCIgY2xhc3M9XCJtZC1zaWRlbmF2LWxlZnQgbWQtd2hpdGVmcmFtZS16MlwiICBpZD1cInNpZGViYXJcIiBtZC1jb21wb25lbnQtaWQ9XCJsZWZ0XCIgbWQtaXMtbG9ja2VkLW9wZW49XCIkbWRNZWRpYShcXCdndC1zbVxcJylcIiAgbWQtdGhlbWU9XCJzbWFydFRoZW1lXCI+XFxuJyArXG4gICAgJyAgICAgICAgPGhlYWRlciBjbGFzcz1cIm1kLXdoaXRlZnJhbWUtMmRwXCI+XFxuJyArXG4gICAgJyAgICAgICAgICAgIDxtZC10b29sYmFyIGxheW91dD1cInJvd1wiPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgPGgzIGNsYXNzPVwibWQtdG9vbGJhci10b29sc1wiIGZsZXggbGF5b3V0PVwicm93XCI+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJpY29uIGhvdXNlX3dpdGhfZ2FyZGVuXzM2XCIgZmxleD1cIjIwXCI+PC9pPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgIDxzcGFuIGZsZXg+RGFzaGJvYXJkPC9zcGFuPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgPC9oMz5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgIDxtZC1tZW51IGNsYXNzPVwibWVudS1zaWRlYmFyXCI+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPG1kLWJ1dHRvbiBhcmlhLWxhYmVsPVwiT3BlbiBwaG9uZSBpbnRlcmFjdGlvbnMgbWVudVwiIGNsYXNzPVwibWQtaWNvbi1idXR0b25cIiBuZy1jbGljaz1cIm9wZW5NZW51KCRtZE9wZW5NZW51LCAkZXZlbnQpXCI+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDxtZC1pY29uIG1kLW1lbnUtb3JpZ2luIG1kLWZvbnQtaWNvbj1cImZhLWVsbGlwc2lzLXZcIiBjbGFzcz1cImZhXCI+PC9tZC1pY29uPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgIDwvbWQtYnV0dG9uPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgIDxtZC1tZW51LWNvbnRlbnQgd2lkdGg9XCI0XCI+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDxtZC1tZW51LWl0ZW0+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBtZC1tZW51LWFsaWduLXRhcmdldD5IZWxsbyBXb3JsZCEhPC9zcGFuPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgICAgICA8L21kLW1lbnUtaXRlbT5cXG4nICtcbiAgICAnXFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPC9tZC1tZW51LWNvbnRlbnQ+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICA8L21kLW1lbnU+XFxuJyArXG4gICAgJyAgICAgICAgICAgIDwvbWQtdG9vbGJhcj5cXG4nICtcbiAgICAnXFxuJyArXG4gICAgJyAgICAgICAgPC9oZWFkZXI+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgIDxtZC1jb250ZW50PlxcbicgK1xuICAgICcgICAgICAgICAgICA8bWQtc3ViaGVhZGVyIGNsYXNzPVwibWQtcHJpbWFyeVwiIGxheW91dD1cInJvd1wiIG5nLWluaXQ9XCJzaG93T3B0aW9ucz1mYWxzZVwiPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgPHNwYW4gZmxleD1cIjEwXCIgY2xhc3M9XCJhdmF0YXJcIj48bmctbGV0dGVyLWF2YXRhciBuZy1pZj1cInVzZXIuZW1haWxcIiBkYXRhPVwie3t1c2VyLmVtYWlsfX1cIiBoZWlnaHQ9XCIzMHB4XCIgd2lkdGg9XCIzMHB4XCIgc2hhcGU9XCJyb3VuZFwiIGFscGhhYmV0Y29sb3JzPVwiYXJyYXlfY29sb3JzXCI+PC9uZy1sZXR0ZXItYXZhdGFyPjwvc3Bhbj5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgIDxzcGFuIGZsZXg+e3t1c2VyLmVtYWlsfCBub2ZpcnN0fX1cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgIDwvc3Bhbj5cXG4nICtcbiAgICAnXFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICA8bWQtaWNvbiBtZC1mb250LWljb249XCJmYS1jaGV2cm9uLWRvd25cIiBjbGFzcz1cImZhIG1kLXByaW1hcnlcIiBuZy1jbGljaz1cInNob3dPcHRpb25zPSFzaG93T3B0aW9uc1wiPjwvbWQtaWNvbj5cXG4nICtcbiAgICAnXFxuJyArXG4gICAgJ1xcbicgK1xuICAgICdcXG4nICtcbiAgICAnICAgICAgICAgICAgPC9tZC1zdWJoZWFkZXI+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicG9wb3Zlci11c2VyLW9wdGlvbnMgbWQtb3Blbi1tZW51LWNvbnRhaW5lciBtZC13aGl0ZWZyYW1lLXoyIG1kLWNsaWNrYWJsZVwiIG5nLWNsYXNzPVwie1xcJ21kLWFjdGl2ZVxcJzpzaG93T3B0aW9uc31cIj5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93bi1jYXJldFwiPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiY2FyZXQtb3V0ZXJcIj48L3NwYW4+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJjYXJldC1pbm5lclwiPjwvc3Bhbj5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgIDwvZGl2PlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgPG1kLWNvbnRlbnQ+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgIDxkaXYgbGF5b3V0PVwiY29sdW1uXCIgbGF5b3V0LWFsaWduPVwic3BhY2UtYmV0d2VlbiBub25lXCI+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgIGZsZXggbGF5b3V0PVwicm93XCIgIGxheW91dC1hbGlnbj1cInNwYWNlLWJldHdlZW4gY2VudGVyXCIgY2xhc3M9XCJpdGVtLXBvcG92ZXJcIj5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmEgZmEtY29nXCIgZmxleD1cIjIwXCI+PC9pPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgZmxleD5TZXR0aW5nczwvYT5cXG4nICtcbiAgICAnXFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgICAgICBcXG4nICtcbiAgICAnICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiAgZmxleCBsYXlvdXQ9XCJyb3dcIiAgbGF5b3V0LWFsaWduPVwic3BhY2UtYmV0d2VlbiBjZW50ZXJcIiBjbGFzcz1cIml0ZW0tcG9wb3ZlclwiPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1wb3dlci1vZmZcIiBmbGV4PVwiMjBcIj48L2k+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBuZy1jbGljaz1cImxvZ291dCgpXCIgZmxleD5Mb2dvdXQ8L2E+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4nICtcbiAgICAnXFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgICAgICAgICAgPC9tZC1jb250ZW50PlxcbicgK1xuICAgICcgICAgICAgICAgICA8L2Rpdj5cXG4nICtcbiAgICAnICAgICAgICA8L21kLWNvbnRlbnQ+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgPC9tZC1zaWRlbmF2PlxcbicgK1xuICAgICdcXG4nICtcbiAgICAnXFxuJyArXG4gICAgJyAgICA8ZGl2IGxheW91dD1cImNvbHVtblwiIGZsZXggaWQ9XCJjb250ZW50XCI+XFxuJyArXG4gICAgJyAgICAgICAgPG1kLWNvbnRlbnQgbGF5b3V0PVwiY29sdW1uXCIgZmxleCBjbGFzcz1cIm1kLXBhZGRpbmdcIiB1aS12aWV3PVwiY29udGVudFwiPlxcbicgK1xuICAgICdcXG4nICtcbiAgICAnICAgICAgICA8L21kLWNvbnRlbnQ+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgPC9kaXY+XFxuJyArXG4gICAgJzwvZGl2PlxcbicgK1xuICAgICdcXG4nICtcbiAgICAnXFxuJyArXG4gICAgJycpO1xufV0pO1xufSkoKTtcblxuKGZ1bmN0aW9uKG1vZHVsZSkge1xudHJ5IHtcbiAgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ0FwcGxpY2F0aW9uJyk7XG59IGNhdGNoIChlKSB7XG4gIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdBcHBsaWNhdGlvbicsIFtdKTtcbn1cbm1vZHVsZS5ydW4oWyckdGVtcGxhdGVDYWNoZScsIGZ1bmN0aW9uKCR0ZW1wbGF0ZUNhY2hlKSB7XG4gICR0ZW1wbGF0ZUNhY2hlLnB1dCgnL3ZpZXdzL19sb2dpbi9tYWluLmh0bWwnLFxuICAgICdcXG4nICtcbiAgICAnPGRpdiAgbGF5b3V0PVwicm93XCIgbGF5b3V0LWFsaWduPVwiY2VudGVyIGNlbnRlclwiIGxheW91dC1maWxsIGlkPVwibG9naW4tYm9keVwiIG1kLXRoZW1lPVwic21hcnRUaGVtZVwiPlxcbicgK1xuICAgICdcXG4nICtcbiAgICAnXFxuJyArXG4gICAgJyAgICA8ZGl2IGxheW91dD1cImNvbHVtblwiIGZsZXgtZ3QtbWQ9XCIzNVwiIGZsZXgteHM9XCI1MFwiIGZsZXgtZ3QteHM9XCI1MFwiIGxheW91dC1wYWRkaW5nPlxcbicgK1xuICAgICdcXG4nICtcbiAgICAnICAgICAgICA8ZGl2IGxheW91dD1cInJvd1wiIGxheW91dC1hbGlnbj1cImNlbnRlciBjZW50ZXJcIj5cXG4nICtcbiAgICAnICAgICAgICAgICAgPGgyPjxpIGNsYXNzPVwiaWNvbiBob3VzZV93aXRoX2dhcmRlbl83MlwiPjwvaT48YnI+U21hcnQgVG93biBBZG1pbmlzdHJhdGlvbjwvaDI+XFxuJyArXG4gICAgJyAgICAgICAgPC9kaXY+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgIDxtZC1jYXJkIGxheW91dD1cInJvd1wiID5cXG4nICtcbiAgICAnICAgICAgICAgICAgPGZvcm0gbmFtZT1cImxvZ2luRm9ybVwiIGZsZXggbGF5b3V0PVwiY29sdW1uXCIgbGF5b3V0LWFsaWduPVwiY2VudGVyIHN0cmV0Y2hcIiBsYXlvdXQtcGFkZGluZyBsYXlvdXQtbWFyZ2luPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgPGgzIGZsZXg+TG9nIGluIHRvIHlvdXIgYWNjb3VudDwvaDM+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICA8bWQtaW5wdXQtY29udGFpbmVyICBjbGFzcz1cIm1kLWJsb2NrXCIgZmxleD5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgICAgICA8bGFiZWw+RW1haWw8L2xhYmVsPlxcbicgK1xuICAgICdcXG4nICtcbiAgICAnICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImVtYWlsXCIgcmVxdWlyZWQgbmFtZT1cImVtYWlsXCIgbmctbW9kZWw9XCJ1c2VyLmVtYWlsXCIgbmctcGF0dGVybj1cIi9eLitALitcXFxcLi4rJC9cIiA+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPGRpdiBuZy1tZXNzYWdlcz1cImxvZ2luRm9ybS5lbWFpbC4kZXJyb3JcIiBtdWx0aXBsZSBtZC1hdXRvLWhpZGU9XCJmYWxzZVwiIG5nLWlmPVxcJ2xvZ2luRm9ybS5lbWFpbC4kZGlydHlcXCc+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgbmctbWVzc2FnZT1cInJlcXVpcmVkXCI+VGhpcyBpcyByZXF1aXJlZC48L2Rpdj5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBuZy1tZXNzYWdlPVwicGF0dGVyblwiPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgICAgICAgICAgWW91ciBlbWFpbCBtdXN0IGxvb2sgbGlrZSBhbiBlLW1haWwgYWRkcmVzcy5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICA8L21kLWlucHV0LWNvbnRhaW5lcj5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgIDxtZC1pbnB1dC1jb250YWluZXIgICBjbGFzcz1cIm1kLWJsb2NrXCIgZmxleD5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgICAgICA8bGFiZWw+UGFzc3dvcmQ8L2xhYmVsPlxcbicgK1xuICAgICdcXG4nICtcbiAgICAnICAgICAgICAgICAgICAgICAgICA8aW5wdXQgbmctbW9kZWw9XCJ1c2VyLnBhc3N3b3JkXCIgdHlwZT1cInBhc3N3b3JkXCIgbmFtZT1cInBhc3N3b3JkXCIgcmVxdWlyZWQ+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPGRpdiBuZy1tZXNzYWdlcz1cImxvZ2luRm9ybS5wYXNzd29yZC4kZXJyb3JcIiBtZC1hdXRvLWhpZGU9XCJmYWxzZVwiIG5nLWlmPVwibG9naW5Gb3JtLnBhc3N3b3JkLiRkaXJ0eVwiPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IG5nLW1lc3NhZ2U9XCJyZXF1aXJlZFwiPlRoaXMgaXMgcmVxdWlyZWQuPC9kaXY+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICA8L21kLWlucHV0LWNvbnRhaW5lcj5cXG4nICtcbiAgICAnICAgICAgICAgICAgICAgIDxtZC1pbnB1dC1jb250YWluZXIgbGF5b3V0LWFsaWduPVwiY2VudGVyIGNlbnRlclwiIGZsZXg+XFxuJyArXG4gICAgJyAgICAgICAgICAgICAgICAgICAgPGRpdiBsYXlvdXQ9XCJyb3dcIiBsYXlvdXQtc209XCJjb2x1bW5cIiBsYXlvdXQtbWFyZ2luPlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgICAgICA8bWQtYnV0dG9uIGNsYXNzPVwibWQtcmFpc2VkXCIgdHlwZT1cInN1Ym1pdFwiIG5nLWNsaWNrPVwibG9naW4oKVwiIGZsZXggZmxleC1zbT1cIjEwMFwiIG5nPkxvZ2luPC9tZC1idXR0b24+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbicgK1xuICAgICcgICAgICAgICAgICAgICAgPC9tZC1pbnB1dC1jb250YWluZXI+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgICAgICA8L2Zvcm0+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgIDwvbWQtY2FyZD5cXG4nICtcbiAgICAnXFxuJyArXG4gICAgJ1xcbicgK1xuICAgICcgICAgICAgIDxkaXYgbGF5b3V0PVwicm93XCIgbGF5b3V0LWFsaWduPVwiY2VudGVyIGNlbnRlclwiPlxcbicgK1xuICAgICcgICAgICAgICAgICA8aDU+PGkgY2xhc3M9XCJmYSBmYS1jb3B5cmlnaHRcIj48L2k+IFNtYXJ0IFRvd24gMjAxNjwvaDU+XFxuJyArXG4gICAgJyAgICAgICAgPC9kaXY+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICdcXG4nICtcbiAgICAnICAgIDwvZGl2PlxcbicgK1xuICAgICdcXG4nICtcbiAgICAnPC9kaXY+XFxuJyArXG4gICAgJ1xcbicgK1xuICAgICdcXG4nICtcbiAgICAnJyk7XG59XSk7XG59KSgpO1xuIiwiYW5ndWxhci5tb2R1bGUoJ0FwcGxpY2F0aW9uJykuZmlsdGVyKFxyXG4gICAgXCJub2ZpcnN0XCIsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbnB1dD9pbnB1dC5zbGljZSgxKTpcIlwiO1xyXG4gICAgICAgIH19XHJcbilcclxuIiwiYW5ndWxhci5tb2R1bGUoJ0FwcGxpY2F0aW9uJylcclxuLmZhY3RvcnkoXCJBcGlTZXJ2aWNlXCIsIGZ1bmN0aW9uKCRyZXNvdXJjZSwgJGxvY2F0aW9uKXtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZW52OiRsb2NhdGlvbi5hYnNVcmwoKS5pbmRleE9mKFwibG9jYWxob3N0XCIpPT0tMT9cInByb2RcIjpcImRldlwiLFxyXG4gICAgICAgIC8vZW52OlwicHJvZFwiLFxyXG4gICAgICAgIHByb2Q6e1xyXG4gICAgICAgICAgICBwcm90b2NvbDpcImh0dHBzXCIsXHJcbiAgICAgICAgICAgIGhvc3Q6XCJzbWFydC10b3duLWRiLmhlcm9rdWFwcC5jb21cIixcclxuICAgICAgICAgICAgcG9ydDpcIlwiLFxyXG4gICAgICAgICAgICByb290OlwiYXBpXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRldjp7XHJcbiAgICAgICAgICAgIHByb3RvY29sOlwiaHR0cFwiLFxyXG4gICAgICAgICAgICBob3N0OlwibG9jYWxob3N0XCIsXHJcbiAgICAgICAgICAgIHBvcnQ6XCI1MDYwXCIsXHJcbiAgICAgICAgICAgIHJvb3Q6XCJhcGlcIlxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGdldEFwaVBhdGg6ZnVuY3Rpb24ocGF0aCl7XHJcbiAgICAgICAgICAgIHZhciBhcGk9dGhpc1t0aGlzLmVudl07XHJcbiAgICAgICAgICAgIHJldHVybiBhcGkucHJvdG9jb2wrXCI6Ly9cIithcGkuaG9zdCsoYXBpLnBvcnQhPT1cIlwiPyhcIjpcIithcGkucG9ydCk6XCJcIikrXCIvXCIrYXBpLnJvb3QrXCIvXCIrcGF0aDtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICByZXN0OmZ1bmN0aW9uKHBhdGgsIG1ldGhvZHMsIGRlZmF1bHRQYXJhbXMpe1xyXG4gICAgICAgICAgICB2YXIgcmVzb3VyY2U9JHJlc291cmNlKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRBcGlQYXRoKHBhdGgpLFxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdFBhcmFtcyB8fCB7fSxcclxuICAgICAgICAgICAgICAgIG1ldGhvZHMgfHwge31cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pO1xyXG5cclxuIiwiYW5ndWxhci5tb2R1bGUoJ0FwcGxpY2F0aW9uJylcclxuICAgIC5mYWN0b3J5KFwiQXV0aEludGVyY2VwdG9yXCIsIGZ1bmN0aW9uKCRxLCAkbG9jYXRpb24pe1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbihjb25maWcpe1xyXG4gICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xyXG5cclxuICAgICAgICAgICAgdmFyIHVzZXI9Z2V0TG9jYWwoXCJ1c2VyXCIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uICYmIHVzZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSB1c2VyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVxdWVzdEVycm9yOiBmdW5jdGlvbihyZWplY3Rpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZWplY3Rpb24pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09ICdFUlJPUicpIHsgLy9Gb3JjZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24ocmVqZWN0aW9uKXtcclxuICAgICAgICAgICAgaWYocmVqZWN0aW9uLnN0YXR1cyA9PT0gNDAzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZSBhY2Nlc28nKTtcclxuICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UudXNlciA9ICcnO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlamVjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcclxuIiwiYW5ndWxhci5tb2R1bGUoJ0FwcGxpY2F0aW9uJylcclxuICAgIC5mYWN0b3J5KFwiT0F1dGhTZXJ2aWNlXCIsIGZ1bmN0aW9uKEFwaVNlcnZpY2Upe1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBiYXNlOlwib2F1dGhcIixcclxuICAgICAgICBsb2dpbjpmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gQXBpU2VydmljZS5yZXN0KHRoaXMuYmFzZStcIi9sb2dpblwiLCB7XHJcbiAgICAgICAgICAgICAgICBfOnttZXRob2Q6XCJQT1NUXCIsIHBhcmFtczp7fX1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBsb2dvdXQ6ZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIEFwaVNlcnZpY2UucmVzdCh0aGlzLmJhc2UrXCIvbG9nb3V0XCIsIHtcclxuICAgICAgICAgICAgICAgIF86e21ldGhvZDpcIkdFVFwiLCBwYXJhbXM6e319XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHdob2lhbTpmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gQXBpU2VydmljZS5yZXN0KHRoaXMuYmFzZStcIi93aG9pYW1cIiwge1xyXG4gICAgICAgICAgICAgICAgXzp7bWV0aG9kOlwiR0VUXCIsIHBhcmFtczp7fX1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ0FwcGxpY2F0aW9uJylcclxuICAgIC5mYWN0b3J5KFwiUmVxdWVzdFNlcnZpY2VcIiwgZnVuY3Rpb24oJHJvb3RTY29wZSl7XHJcblxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgRXJyb3I6ZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHJlcyl7XHJcbiAgICAgICAgICAgICAgdmFyIGRhdGE9cmVzLmRhdGE7XHJcbiAgICAgICAgICAgICAgICRyb290U2NvcGUuc2hvd1NpbXBsZVRvYXN0KGRhdGEuZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICBPbmVEYXRhOmZ1bmN0aW9uKGtleSwgY2Ipe1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ocmVzKXtcclxuICAgICAgICAgICAgICAgIGlmKCFyZXMuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRyb290U2NvcGUuc2hvd1NpbXBsZVRvYXN0KFwiTm8gZGF0YVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZT1yZXMuZGF0YVtrZXldO1xyXG4gICAgICAgICAgICAgICAgaWYoIXZhbHVlKXJldHVybiAkcm9vdFNjb3BlLnNob3dTaW1wbGVUb2FzdChcIk5vIFZhbHVlc1wiKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBjYih2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
